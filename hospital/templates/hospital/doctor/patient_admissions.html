{% extends "hospital/base.html" %}

{% block title %}Patient Admissions - SantKrupa Hospital{% endblock %}

{% block content %}
<div class="container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h1>üìã {{ patient.patient_name }} - Admission History</h1>
        <a href="javascript:history.back()" class="btn" style="background-color: #666;">
            ‚Üê Back
        </a>
    </div>

    <div class="card" style="margin-bottom: 20px; background-color: #f0f7ff; border-left: 4px solid #2196f3;">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
            <div>
                <p style="margin: 0; color: #666; font-size: 12px;">Patient ID</p>
                <p style="margin: 8px 0 0 0; font-weight: bold; font-size: 14px;">{{ patient.patient_id }}</p>
            </div>
            <div>
                <p style="margin: 0; color: #666; font-size: 12px;">Age</p>
                <p style="margin: 8px 0 0 0; font-weight: bold; font-size: 14px;">{{ patient.age }} years</p>
            </div>
            <div>
                <p style="margin: 0; color: #666; font-size: 12px;">Phone</p>
                <p style="margin: 8px 0 0 0; font-weight: bold; font-size: 14px;">{{ patient.phone_number }}</p>
            </div>
            <div>
                <p style="margin: 0; color: #666; font-size: 12px;">Registered</p>
                <p style="margin: 8px 0 0 0; font-weight: bold; font-size: 14px;">{{ patient.registration_date|date:"M d, Y" }}</p>
            </div>
        </div>
    </div>

    {% if admissions %}
        <div style="margin-bottom: 30px;">
            <h2 style="margin: 0 0 20px 0; color: #333;">{{ admissions.count }} Admission{% if admissions.count != 1 %}s{% endif %}</h2>
            
            {% for admission in admissions %}
                <div class="card" style="margin-bottom: 15px; border-left: 4px solid 
                    {% if admission.status == 'discharged' %}#4caf50
                    {% elif admission.status == 'stable' %}#2196f3
                    {% elif admission.status == 'in_treatment' %}#ff9800
                    {% elif admission.status == 'admitted' %}#ffc107
                    {% else %}#999{% endif %};">
                    
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <div>
                            <h3 style="margin: 0 0 5px 0;">{{ admission.get_admission_type_display }}</h3>
                            <p style="margin: 0; color: #666; font-size: 13px;">
                                Admitted: <strong>{{ admission.admission_date|date:"M d, Y H:i" }}</strong>
                            </p>
                        </div>
                        <span style="background-color: 
                            {% if admission.status == 'discharged' %}#4caf50
                            {% elif admission.status == 'stable' %}#2196f3
                            {% elif admission.status == 'in_treatment' %}#ff9800
                            {% elif admission.status == 'admitted' %}#ffc107
                            {% else %}#999{% endif %};
                            color: white; padding: 8px 12px; border-radius: 20px; font-size: 12px; font-weight: bold;">
                            {{ admission.get_status_display }}
                        </span>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div>
                            <p style="margin: 0; color: #666; font-size: 12px;">Bed/Room</p>
                            <p style="margin: 5px 0 0 0;">{{ admission.bed_number|default:"Not assigned" }}{% if admission.room_number %}, {{ admission.room_number }}{% endif %}</p>
                        </div>
                        
                        <div>
                            <p style="margin: 0; color: #666; font-size: 12px;">Doctor</p>
                            <p style="margin: 5px 0 0 0;">
                                {% if admission.doctor %}
                                    Dr. {{ admission.doctor.user.first_name }} {{ admission.doctor.user.last_name }}
                                {% else %}
                                    Not assigned
                                {% endif %}
                            </p>
                        </div>

                        <div>
                            <p style="margin: 0; color: #666; font-size: 12px;">Duration</p>
                            <p style="margin: 5px 0 0 0;">
                                {% if admission.discharge_date %}
                                    {% widthratio admission.discharge_date|add:"-d"|add:admission.admission_date|add:"d" 1 1 %} days
                                {% else %}
                                    In hospital
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <p style="margin: 0; color: #666; font-size: 12px;">Reason for Admission</p>
                        <p style="margin: 5px 0 0 0;">{{ admission.reason_for_admission }}</p>
                    </div>

                    {% if admission.medical_history %}
                        <div style="margin-bottom: 15px;">
                            <p style="margin: 0; color: #666; font-size: 12px;">Medical History</p>
                            <p style="margin: 5px 0 0 0;">{{ admission.medical_history }}</p>
                        </div>
                    {% endif %}

                    {% if admission.allergies %}
                        <div style="margin-bottom: 15px; padding: 10px; background-color: #ffebee; border-radius: 4px;">
                            <p style="margin: 0; color: #c62828; font-size: 12px;"><strong>‚ö†Ô∏è ALLERGIES</strong></p>
                            <p style="margin: 5px 0 0 0; color: #c62828;">{{ admission.allergies }}</p>
                        </div>
                    {% endif %}

                    {% if admission.treatment_logs.count > 0 %}
                        <div style="margin-bottom: 15px; padding: 10px; background-color: #f5f5f5; border-radius: 4px;">
                            <p style="margin: 0; color: #333; font-size: 12px;"><strong>üíä Treatments:</strong> {{ admission.treatment_logs.count }} recorded</p>
                        </div>
                    {% endif %}

                    {% if admission.discharge_date %}
                        <div style="margin-bottom: 15px; padding: 10px; background-color: #e8f5e9; border-radius: 4px;">
                            <p style="margin: 0; color: #2e7d32; font-size: 12px;"><strong>Discharged:</strong> {{ admission.discharge_date|date:"M d, Y H:i" }}</p>
                            {% if admission.follow_up_date %}
                            <p style="margin: 5px 0 0 0; color: #2e7d32; font-size: 12px;"><strong>Follow-up:</strong> {{ admission.follow_up_date|date:"M d, Y" }}</p>
                            {% endif %}
                        </div>
                    {% endif %}

                    <div style="display: flex; gap: 10px;">
                        <a href="{% url 'admission_details' admission.id clinic_slug=clinic.slug %}" class="btn" style="flex: 1;">
                            üëÅÔ∏è View Details
                        </a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="card" style="text-align: center; padding: 40px;">
            <p style="color: #999; font-size: 16px;">üì≠ No admission records found for this patient.</p>
        </div>
    {% endif %}
</div>

<style>
    .btn {
        background-color: #667eea;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        transition: background-color 0.3s ease;
        border: 1px solid #667eea;
        text-align: center;
    }
    
    .btn:hover {
        background-color: #5a67d8;
        border-color: #5a67d8;
    }
    
    .card {
        background: white;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    h1, h2, h3 {
        color: #333;
        margin: 0;
    }
    
    .container {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }

    @media (max-width: 600px) {
        [style*="grid-template-columns: repeat"] {
            grid-template-columns: 1fr !important;
        }
    }
</style>
{% endblock %}
